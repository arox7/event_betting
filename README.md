# Kalshi Market Analysis Dashboard

A Python-based dashboard for analyzing Kalshi prediction markets with AI-powered screening capabilities and interactive visualizations.

## Features

- **Interactive Dashboard**: Streamlit-based web interface for market analysis
- **AI-Powered Screening**: Natural language queries using Gemini AI for custom market filtering
- **Configurable Criteria**: Customizable screening parameters (volume, spread, liquidity, etc.)
- **Market Analysis**: Detailed scoring system based on multiple factors
- **Real-time Data**: Fetch and analyze current market data on demand
- **API Integration**: Full integration with Kalshi's Python SDK

## Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd event_betting
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

3. Set up environment variables:
```bash
# Create .env file with your Kalshi API credentials
# See SETUP.md for detailed instructions
```

## Configuration

Create a `.env` file with your Kalshi API credentials. See `SETUP.md` for detailed instructions:

```env
# Kalshi API Configuration
KALSHI_API_KEY_ID=your-api-key-id-here
KALSHI_PRIVATE_KEY_PATH=path/to/private_key.pem

# Environment (demo or production)
KALSHI_DEMO_MODE=true
KALSHI_API_HOST=https://api.elections.kalshi.com/trade-api/v2

# Dashboard Configuration
DASHBOARD_PORT=8501
DASHBOARD_HOST=localhost

# Optional: Gemini AI Configuration
GEMINI_API_KEY=your-gemini-api-key-here
```

**Important**: This dashboard uses proper Kalshi API authentication following the [official documentation](https://docs.kalshi.com/getting_started/api_keys). You need to:
1. Generate API credentials from your Kalshi account
2. Save your private key as a `.pem` file
3. Configure the environment variables
4. (Optional) Get a Gemini API key for AI features

## Usage

### Running the Dashboard

Start the web dashboard:
```bash
python main.py
```

Or with a custom port:
```bash
python main.py --port 8502
```

Use the startup script (recommended):
```bash
./run_dashboard.sh
```

Or run directly with Streamlit:
```bash
streamlit run dashboard.py
```

The dashboard will be available at `http://localhost:8501` (or your specified port)

## Dashboard Features

- **Market Data Analysis**: Fetch and analyze current market data on demand
- **AI-Powered Screening**: Use natural language to create custom market filters
- **Summary Metrics**: Total markets, opportunities, and filtering statistics
- **Interactive Tables**: Sortable and filterable market data
- **Visual Analytics**: Charts and graphs for market distribution and trends
- **Market Details**: Detailed view of individual markets with full information
- **Custom Filtering**: Advanced filtering options for market characteristics

## Analysis Criteria

The dashboard can filter and analyze markets based on:

- **Volume**: Trading volume requirements (total and 24h)
- **Spread**: Bid-ask spread analysis (percentage and cents)
- **Liquidity**: Market liquidity requirements
- **Time to Close**: Days until market close
- **Category**: Market categories (politics, economics, etc.)
- **Price Range**: Market price ranges and volatility
- **AI Queries**: Natural language filtering with Gemini AI

## AI-Powered Analysis

The dashboard includes advanced AI features powered by Google Gemini:

- **Natural Language Queries**: Ask questions like "Show me markets closing soon with high volume" or "Find undervalued political markets"
- **Custom Screening Functions**: AI generates Python code to filter markets based on your specific criteria
- **Interactive Code Editing**: Review and modify AI-generated screening logic
- **Smart Market Insights**: Get AI-powered analysis of market trends and opportunities

### Example AI Queries
- "Markets with tight spreads and high liquidity"
- "Election markets closing in the next 30 days"
- "Undervalued markets with recent volume spikes"
- "Markets where the probability seems disconnected from fundamentals"

## Project Structure

```
event_betting/
├── main.py                 # Main application entry point (dashboard launcher)
├── config.py              # Configuration settings
├── models.py              # Data models and classes
├── kalshi_client.py       # Kalshi API client wrapper
├── market_screener.py     # Market screening logic
├── gemini_screener.py     # AI-powered screening with Gemini
├── dashboard.py           # Streamlit dashboard (main interface)
├── requirements.txt       # Python dependencies
├── test_event.py          # Event testing utilities
├── test_market.py         # Market testing utilities
├── test_setup.py          # Setup validation script
├── run_dashboard.sh       # Quick start script
└── README.md             # This file
```

## API Requirements

To use the dashboard, you'll need:

### Required
1. **Kalshi API Key ID**: Get from your Kalshi account profile
2. **RSA Private Key**: Generated by Kalshi (saved as .pem file)

### Optional
3. **Gemini API Key**: For AI-powered features (get from [Google AI Studio](https://makersuite.google.com/app/apikey))

The application uses proper RSA-PSS signature authentication as specified in the [Kalshi API documentation](https://docs.kalshi.com/getting_started/api_keys). This provides better security and follows Kalshi's recommended authentication method.

## Logging

The application logs to console:

- Dashboard startup and status
- API connection status
- Error messages
- User interactions

## Development

### Adding New Analysis Features

1. Update `ScreeningCriteria` in `models.py`
2. Add filtering logic in `market_screener.py`
3. Update dashboard UI in `dashboard.py`
4. Add AI prompts in `gemini_screener.py` for natural language support

### Customizing the Dashboard

The dashboard is built with Streamlit and can be customized by modifying `dashboard.py`:

- Add new charts and visualizations
- Modify the layout and styling
- Add new filtering and analysis options
- Integrate additional AI capabilities

## Troubleshooting

### Common Issues

1. **API Connection Failed**: Check your API credentials and network connection
2. **No Markets Found**: Verify the API is returning data and check filters  
3. **Dashboard Not Loading**: Ensure Streamlit is installed and port is available
4. **AI Features Not Working**: Verify your Gemini API key is set in the `.env` file
5. **Permission Errors**: Make sure the startup script is executable: `chmod +x run_dashboard.sh`

### Debug Mode

Enable debug logging by setting the environment variable:

```bash
export PYTHONPATH=. && python -c "import logging; logging.basicConfig(level=logging.DEBUG)" && python main.py
```

## License

This project is for educational and research purposes. Please ensure compliance with Kalshi's terms of service and applicable regulations.

## Disclaimer

This software is provided as-is for educational and analysis purposes. This is a market analysis tool, not a trading bot. Any trading decisions should be made carefully with proper research and risk management. Always comply with applicable regulations and platform terms of service.
